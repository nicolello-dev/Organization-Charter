import Head from "next/head";

import { createContext, useContext, useEffect, useState, useRef } from "react";

import Filter from "@/components/filter"
import ViewData from "@/components/viewData";

import type { Employee } from "@prisma/client";

const filters = [
  'team', 'area', 'function', 'tribe'
];
const filter: {[key: string]: string} = {};
filters.forEach(f => {
  filter[f] = '*';
  filter[f + ' lead'] = "*";
})

type filterContextType = {
  filtersData: {[key: string]: string},
  data: Employee[] | undefined,
  setData: React.Dispatch<React.SetStateAction<any>> // Type function
}

export const filterContext = createContext<filterContextType>({
  filtersData: filter,
  data: undefined,
  setData: () => undefined
});

export default function Home() {

  const [data, setData] = useState<Employee[] | undefined>(undefined);

  useEffect(() => {
    fetch('/api/getSheet')
      .then(r => r.json())
      .then((r: Employee[]) => setData(r))
      .catch(err => console.error(err));
  }, []);

  const filterctx = useContext(filterContext)

  useEffect(() => {
  }, [filterctx.filtersData])

  return (
    <>
      <Head>
        <title>Organization Charter - Improved</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="flex min-h-screen flex-col items-center justify-center bg-white dark:bg-black">
        <filterContext.Provider value={{
          filtersData: filter,
          data,
          setData
        }}>
          <Filter/>
          <ViewData data={data}/>
        </filterContext.Provider>
      </main>
    </>
  );
}